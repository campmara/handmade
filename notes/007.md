# Day 007: Initializing DirectSound

We started today by addressing some concerns from emails, making the code a little stronger. Previous notes pages have been revised to reflect these changes.

We also handled Alt+F4 keystrokes, since that would be coming through the SYSKEYDOWN message and we weren't handling it before so Alt+F4 wouldn't actually close the game.

```c++
bool alt_key_was_down = ((l_param & (1 << 29)) != 0); // Don't forget the parentheses!
if (vk_code == VK_F4 && alt_key_was_down)
{
    global_is_running = false;
}
```

## Operator Precedence

Remember that the bitwise operator is of lower precedence than the `!=` operator!

## Casey Doesn't Like Bool!

In C++, `bool` is defined with some kinda odd semantics to have to be 0 or 1. Oftentimes, Casey circumvents this by defining a typedef like so:

```c++
typedef int32 bool32;
```

This way, he can signal his intent to use this int32 value to only really be 0 or 1, and avoid the weirdness that the compiler has to go through in order to set up bool values.

## On XInputGetState

Apparently XInput will stall for several milliseconds if you call `XInputGetState` on a controller that isn't actually plugged in or available. Currently our code does this implicitly and we will eventually have to fix it.

The way Casey recommends to fix it is to actually hook into the HID messages that come in from the operating system in order to track when a controller is connected.

## Intro to Sound Programming for Games

You allocate a circular buffer per sound, and when it gets to the end it will loop around.

We will allocate a big buffer that's 2 seconds long. We will output 800 samples per frame (48khz / 60fps). We always allocate a little bit ahead of the current position of the buffer so that by the time we load it it will play without latency.

On any given frame, you are computing the frame that is gonna get rendered to the screen, and at the same time you are computing the audio that will play behind it.

Today we will get into DirectSound and open up the buffer. It's just memory that we can write into!

We set up a sort of halfway version of the #defines for the DirectSoundCreate function like so:

```c++
#define DIRECT_SOUND_CREATE(name) HRESULT WINAPI name(LPCGUID pcGuidDevice, LPDIRECTSOUND *ppDS, LPUNKNOWN pUnkOuter)
typedef DIRECT_SOUND_CREATE(direct_sound_create);

// then we defined the following function to use them:
internal void Win32InitDirectSound(HWND window)
{
    HMODULE direct_sound_library = LoadLibraryA("dsound.dll");

    if (direct_sound_library)
    {
        direct_sound_create *DirectSoundCreate = 
            (direct_sound_create *)GetProcAddress(direct_sound_library, "DirectSoundCreate");

        LPDIRECTSOUND direct_sound;
        if (DirectSoundCreate && SUCCEEDED(DirectSoundCreate(0, &direct_sound, 0)))
        {
            // Use the direct_sound object.
        }
        ...
    }
    ...
}

```